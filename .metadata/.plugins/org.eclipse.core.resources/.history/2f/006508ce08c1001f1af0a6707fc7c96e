#include <avr/io.h>
#include <util/delay.h>

void InitPWM()
{
   /*
   TCCR0 - Timer Counter Control Register (TIMER0)
   -----------------------------------------------
   BITS DESCRIPTION


   NO:   NAME   DESCRIPTION
   --------------------------
   BIT 7 : FOC0   Force Output Compare [Not used in this example]
   BIT 6 : WGM00  Wave form generartion mode [SET to 1]
   BIT 5 : COM01  Compare Output Mode        [SET to 1]
   BIT 4 : COM00  Compare Output Mode        [SET to 0]

   BIT 3 : WGM01  Wave form generation mode [SET to 1]
   BIT 2 : CS02   Clock Select               [SET to 0]
   BIT 1 : CS01   Clock Select               [SET to 0]
   BIT 0 : CS00   Clock Select               [SET to 1]

   The above settings are for
   --------------------------

   Timer Clock = CPU Clock (No Prescalling)
   Mode        = Fast PWM
   PWM Output  = Non Inverted

   */


   TCCR1A |= (1<<WGM10)|(1<<WGM11)|(1<<COM1A1);
   TCCR1B |= (1<<CS12) | (1<<CS12) | (1<<CS10);
   DDRB|=(1<<PB3);
}


void SetPWMOutput(uint8_t duty)
{
  OCR1A=duty;
  OCR1B=duty;
}

int main()
{
   uint8_t brightness=0;

   InitPWM();

   while(1)
   {
      for(brightness=0;brightness<255;brightness++)
      {
         SetPWMOutput(brightness);
         _delay_ms(1);
      }

      for(brightness=255;brightness>0;brightness--)
      {
         SetPWMOutput(brightness);
         _delay_ms(1);
      }
   }
   return 0;
}
